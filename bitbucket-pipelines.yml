image: node:22

options:
  max-time: 20
  size: 2x

pipelines:
  branches:
    fix/test-pipelines: # Runs only on your testing branch
      - step:
          name: Install, Lint & Test
          caches:
            - node
          script:
            - echo "ğŸ›  Installing dependencies (legacy peer deps to avoid conflicts)..."
            - npm ci --legacy-peer-deps
            - echo "ğŸ” Linting..."
            - npm run lint
            - echo "ğŸ§ª Running tests..."
            - npm run test:ci
          artifacts:
            - coverage/**
    main:
      - step:
          name: Install, Lint & Test (Production)
          caches:
            - node
          script:
            - echo "ğŸ›  Installing dependencies..."
            - npm ci --legacy-peer-deps
            - echo "ğŸ” Linting..."
            - npm run lint
            - echo "ğŸ§ª Running tests..."
            - npm run test:ci
          artifacts:
            - coverage/**
definitions:
  caches:
    node: ~/.npm
